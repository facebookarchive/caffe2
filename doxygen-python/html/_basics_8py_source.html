<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Caffe2 - Python API: caffe2/python/tutorials/py_gen/Basics.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="/static/favicon.png" type="image/x-icon">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
<link href="main.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo" width="56"><a href="/"><img alt="Logo" src="Caffe2-with-name-55-tall.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Caffe2 - Python API
   </div>
   <div id="projectbrief">A deep learning, cross platform ML framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="/doxygen-c/html/classes.html"><span>C++&#160;API</span></a></li>
      <li><a href="/doxygen-python/html/annotated.html"><span>Python&#160;API</span></a></li>
      <li><a href="https://github.com/caffe2/caffe2"><span>GitHub</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_20697b8f204bdfcab31e6b1a416f3ab8.html">caffe2</a></li><li class="navelem"><a class="el" href="dir_f4fda25fc5253eea1ed54677ae5fa2de.html">python</a></li><li class="navelem"><a class="el" href="dir_97a8e4938fab5a0841bdb9cd8076985e.html">tutorials</a></li><li class="navelem"><a class="el" href="dir_38e1d20e965e77ed1a3671bbc2942034.html">py_gen</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Basics.py</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">#########################################################</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"># DO NOT EDIT THIS FILE. IT IS GENERATED AUTOMATICALLY. #</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"># PLEASE LOOK INTO THE README FOR MORE INFORMATION.     #</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">#########################################################</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"># coding: utf-8</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"># # Caffe2 Basic Concepts - Operators &amp; Nets</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"># </span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"># In this tutorial we will go through a set of Caffe2 basics: the basic concepts including how operators and nets are being written.</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"># </span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"># First, let&#39;s import caffe2. `core` and `workspace` are usually the two that you need most. If you want to manipulate protocol buffers generated by caffe2, you probably also want to import `caffe2_pb2` from `caffe2.proto`.</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"># In[ ]:</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"># We&#39;ll also import a few standard python libraries</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keyword">import</span> time</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"># These are the droids you are looking for.</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="keyword">from</span> <a class="code" href="namespacecaffe2_1_1python.html">caffe2.python</a> <span class="keyword">import</span> core, workspace</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="keyword">from</span> caffe2.proto <span class="keyword">import</span> caffe2_pb2</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"># Let&#39;s show all plots inline.</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"># You might see a warning saying that caffe2 does not have GPU support. That means you are running a CPU-only build. Don&#39;t be alarmed - anything CPU is still runnable without problem.</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"># ## Workspaces</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"># </span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"># Let&#39;s cover workspaces first, where all the data reside.</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"># </span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"># If you are familiar with Matlab, workspace consists of blobs you create and store in memory. For now, consider a blob to be a N-dimensional Tensor similar to numpy&#39;s ndarray, but is contiguous. Down the road, we will show you that a blob is actually a typed pointer that can store any type of C++ objects, but Tensor is the most common type stored in a blob. Let&#39;s show what the interface looks like.</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment"># </span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment"># `Blobs()` prints out all existing blobs in the workspace. </span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment"># `HasBlob()` queries if a blob exists in the workspace. For now, we don&#39;t have anything yet.</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment"># In[ ]:</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;print(<span class="stringliteral">&quot;Current blobs in the workspace: {}&quot;</span>.format(workspace.Blobs()))</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;print(<span class="stringliteral">&quot;Workspace has blob &#39;X&#39;? {}&quot;</span>.format(workspace.HasBlob(<span class="stringliteral">&quot;X&quot;</span>)))</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment"># We can feed blobs into the workspace using `FeedBlob()`.</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment"># In[3]:</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;X = np.random.randn(2, 3).astype(np.float32)</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;print(<span class="stringliteral">&quot;Generated X from numpy:\n{}&quot;</span>.format(X))</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;workspace.FeedBlob(<span class="stringliteral">&quot;X&quot;</span>, X)</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment"># Now, let&#39;s take a look what blobs there are in the workspace.</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment"># In[4]:</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;print(<span class="stringliteral">&quot;Current blobs in the workspace: {}&quot;</span>.format(workspace.Blobs()))</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;print(<span class="stringliteral">&quot;Workspace has blob &#39;X&#39;? {}&quot;</span>.format(workspace.HasBlob(<span class="stringliteral">&quot;X&quot;</span>)))</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;print(<span class="stringliteral">&quot;Fetched X:\n{}&quot;</span>.format(workspace.FetchBlob(<span class="stringliteral">&quot;X&quot;</span>)))</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment"># Let&#39;s verify that the arrays are equal.</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment"># In[5]:</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;np.testing.assert_array_equal(X, workspace.FetchBlob(<span class="stringliteral">&quot;X&quot;</span>))</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment"># Also, if you are trying to access a blob that does not exist, an error will be thrown:</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment"># In[6]:</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="keywordflow">try</span>:</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    workspace.FetchBlob(<span class="stringliteral">&quot;invincible_pink_unicorn&quot;</span>)</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="keywordflow">except</span> RuntimeError <span class="keyword">as</span> err:</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    print(err)</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment"># One thing that you might not use immediately: you can have multiple workspaces in Python using different names, and switch between them. Blobs in different workspaces are separate from each other. You can query the current workspace using `CurrentWorkspace`. Let&#39;s try switching the workspace by name (gutentag) and creating a new one if it doesn&#39;t exist.</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment"># In[7]:</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;print(<span class="stringliteral">&quot;Current workspace: {}&quot;</span>.format(workspace.CurrentWorkspace()))</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;print(<span class="stringliteral">&quot;Current blobs in the workspace: {}&quot;</span>.format(workspace.Blobs()))</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment"># Switch the workspace. The second argument &quot;True&quot; means creating </span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment"># the workspace if it is missing.</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;workspace.SwitchWorkspace(<span class="stringliteral">&quot;gutentag&quot;</span>, <span class="keyword">True</span>)</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment"># Let&#39;s print the current workspace. Note that there is nothing in the</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment"># workspace yet.</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;print(<span class="stringliteral">&quot;Current workspace: {}&quot;</span>.format(workspace.CurrentWorkspace()))</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;print(<span class="stringliteral">&quot;Current blobs in the workspace: {}&quot;</span>.format(workspace.Blobs()))</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment"># Let&#39;s switch back to the default workspace.</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment"># In[8]:</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;workspace.SwitchWorkspace(<span class="stringliteral">&quot;default&quot;</span>)</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;print(<span class="stringliteral">&quot;Current workspace: {}&quot;</span>.format(workspace.CurrentWorkspace()))</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;print(<span class="stringliteral">&quot;Current blobs in the workspace: {}&quot;</span>.format(workspace.Blobs()))</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment"># Finally, `ResetWorkspace()` clears anything that is in the current workspace.</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment"># In[9]:</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;workspace.ResetWorkspace()</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment"># ## Operators</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment"># </span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment"># Operators in Caffe2 are kind of like functions. From the C++ side, they all derive from a common interface, and are registered by type, so that we can call different operators during runtime. The interface of operators is defined in `caffe2/proto/caffe2.proto`. Basically, it takes in a bunch of inputs, and produces a bunch of outputs.</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment"># </span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment"># Remember, when we say &quot;create an operator&quot; in Caffe2 Python, nothing gets run yet. All it does is to create the protocol buffere that specifies what the operator should be. At a later time it will be sent to the C++ backend for execution. If you are not familiar with protobuf, it is a json-like serialization tool for structured data. Find more about protocol buffers [here](https://developers.google.com/protocol-buffers/).</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment"># </span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment"># Let&#39;s see an actual example.</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment"># In[10]:</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment"># Create an operator.</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;op = core.CreateOperator(</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="stringliteral">&quot;Relu&quot;</span>, <span class="comment"># The type of operator that we want to run</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    [<span class="stringliteral">&quot;X&quot;</span>], <span class="comment"># A list of input blobs by their names</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    [<span class="stringliteral">&quot;Y&quot;</span>], <span class="comment"># A list of output blobs by their names</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;)</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment"># and we are done!</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment"># As we mentioned, the created op is actually a protobuf object. Let&#39;s show the content.</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment"># In[11]:</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;print(<span class="stringliteral">&quot;Type of the created op is: {}&quot;</span>.format(type(op)))</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;print(<span class="stringliteral">&quot;Content:\n&quot;</span>)</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;print(str(op))</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment"># OK, let&#39;s run the operator. We first feed in the input X to the workspace. </span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment"># Then the simplest way to run an operator is to do `workspace.RunOperatorOnce(operator)`</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment"># In[12]:</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;workspace.FeedBlob(<span class="stringliteral">&quot;X&quot;</span>, np.random.randn(2, 3).astype(np.float32))</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;workspace.RunOperatorOnce(op)</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment"># After execution, let&#39;s see if the operator is doing the right thing, which is our neural network&#39;s activation function ([Relu](https://en.wikipedia.org/wiki/Rectifier_(neural_networks))) in this case.</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment"># In[13]:</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;print(<span class="stringliteral">&quot;Current blobs in the workspace: {}\n&quot;</span>.format(workspace.Blobs()))</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;print(<span class="stringliteral">&quot;X:\n{}\n&quot;</span>.format(workspace.FetchBlob(<span class="stringliteral">&quot;X&quot;</span>)))</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;print(<span class="stringliteral">&quot;Y:\n{}\n&quot;</span>.format(workspace.FetchBlob(<span class="stringliteral">&quot;Y&quot;</span>)))</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;print(<span class="stringliteral">&quot;Expected:\n{}\n&quot;</span>.format(np.maximum(workspace.FetchBlob(<span class="stringliteral">&quot;X&quot;</span>), 0)))</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment"># This is working if your Expected output matches your Y output in this example.</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment"># </span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment"># Operators also take optional arguments if needed. They are specified as key-value pairs. Let&#39;s take a look at one simple example, which takes a tensor and fills it with Gaussian random variables.</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment"># In[14]:</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;op = core.CreateOperator(</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="stringliteral">&quot;GaussianFill&quot;</span>,</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    [], <span class="comment"># GaussianFill does not need any parameters.</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    [<span class="stringliteral">&quot;Z&quot;</span>],</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    shape=[100, 100], <span class="comment"># shape argument as a list of ints.</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    mean=1.0,  <span class="comment"># mean as a single float</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    std=1.0, <span class="comment"># std as a single float</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;)</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;print(<span class="stringliteral">&quot;Content of op:\n&quot;</span>)</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;print(str(op))</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment"># Let&#39;s run it and see if things are as intended.</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment"># In[15]:</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;workspace.RunOperatorOnce(op)</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;temp = workspace.FetchBlob(<span class="stringliteral">&quot;Z&quot;</span>)</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;pyplot.hist(temp.flatten(), bins=50)</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;pyplot.title(<span class="stringliteral">&quot;Distribution of Z&quot;</span>)</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment"># If you see a bell shaped curve then it worked!</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment"># ## Nets</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment"># </span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment"># Nets are essentially computation graphs. We keep the name `Net` for backward consistency (and also to pay tribute to neural nets). A Net is composed of multiple operators just like a program written as a sequence of commands. Let&#39;s take a look.</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment"># </span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment"># When we talk about nets, we will also talk about BlobReference, which is an object that wraps around a string so we can do easy chaining of operators.</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment"># </span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment"># Let&#39;s create a network that is essentially the equivalent of the following python math:</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment"># ```</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment"># X = np.random.randn(2, 3)</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment"># W = np.random.randn(5, 3)</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment"># b = np.ones(5)</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment"># Y = X * W^T + b</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment"># ```</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment"># We&#39;ll show the progress step by step. Caffe2&#39;s `core.Net` is a wrapper class around a NetDef protocol buffer.</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment"># When creating a network, its underlying protocol buffer is essentially empty other than the network name. Let&#39;s create the net and then show the proto content.</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment"># In[16]:</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;net = core.Net(<span class="stringliteral">&quot;my_first_net&quot;</span>)</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;print(<span class="stringliteral">&quot;Current network proto:\n\n{}&quot;</span>.format(net.Proto()))</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment"># Let&#39;s create a blob called X, and use GaussianFill to fill it with some random data.</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment"># In[17]:</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;X = net.GaussianFill([], [<span class="stringliteral">&quot;X&quot;</span>], mean=0.0, std=1.0, shape=[2, 3], run_once=0)</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;print(<span class="stringliteral">&quot;New network proto:\n\n{}&quot;</span>.format(net.Proto()))</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment"># You might have observed a few differences from the earlier `core.CreateOperator` call. Basically, when we have a net, you can direct create an operator *and* add it to the net at the same time using Python tricks: essentially, if you call `net.SomeOp` where SomeOp is a registered type string of an operator, this essentially gets translated to</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment"># ```</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment"># op = core.CreateOperator(&quot;SomeOp&quot;, ...)</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment"># net.Proto().op.append(op)</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment"># ```</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment"># </span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment"># Also, you might be wondering what X is. X is a `BlobReference` which basically records two things:</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment"># - what its name is. You can access the name by str(X)</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment"># - which net it gets created from. It is recorded by an internal variable `_from_net`, but most likely</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment"># you won&#39;t need that.</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment"># </span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment"># Let&#39;s verify it. Also, remember, we are not actually running anything yet, so X contains nothing but a symbol. Don&#39;t expect to get any numerical values out of it right now :)</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment"># In[18]:</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;print(<span class="stringliteral">&quot;Type of X is: {}&quot;</span>.format(type(X)))</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;print(<span class="stringliteral">&quot;The blob name is: {}&quot;</span>.format(str(X)))</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment"># Let&#39;s continue to create W and b.</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment"># In[19]:</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;W = net.GaussianFill([], [<span class="stringliteral">&quot;W&quot;</span>], mean=0.0, std=1.0, shape=[5, 3], run_once=0)</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;b = net.ConstantFill([], [<span class="stringliteral">&quot;b&quot;</span>], shape=[5,], value=1.0, run_once=0)</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment"># Now, one simple code sugar: since the BlobReference objects know what net it is generated from, in addition to creating operators from net, you can also create operators from BlobReferences. Let&#39;s create the FC operator in this way.</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment"># In[20]:</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;Y = X.FC([W, b], [<span class="stringliteral">&quot;Y&quot;</span>])</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment"># Under the hood, `X.FC(...)` simply delegates to `net.FC` by inserting `X` as the first input of the corresponding operator, so what we did above is equivalent to</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment"># ```</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment"># Y = net.FC([X, W, b], [&quot;Y&quot;])</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment"># ```</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment"># </span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment"># Let&#39;s take a look at the current network.</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment"># In[21]:</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;print(<span class="stringliteral">&quot;Current network proto:\n\n{}&quot;</span>.format(net.Proto()))</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment"># Too verbose huh? Let&#39;s try to visualize it as a graph. Caffe2 ships with a very minimal graph visualization tool for this purpose. Let&#39;s show that in ipython.</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment"># In[22]:</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="keyword">from</span> <a class="code" href="namespacecaffe2_1_1python.html">caffe2.python</a> <span class="keyword">import</span> net_drawer</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="keyword">from</span> IPython <span class="keyword">import</span> display</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;graph = net_drawer.GetPydotGraph(net, rankdir=<span class="stringliteral">&quot;LR&quot;</span>)</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;display.Image(graph.create_png(), width=800)</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment"># So we have defined a `Net`, but nothing gets executed yet. Remember that the net above is essentially a protobuf that holds the definition of the network. When we actually want to run the network, what happens under the hood is:</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment"># - Instantiate a C++ net object from the protobuf;</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment"># - Call the instantiated net&#39;s Run() function.</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment"># </span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment"># Before we do anything, we should clear any earlier workspace variables with `ResetWorkspace()`.</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment"># </span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment"># Then there are two ways to run a net from Python. We will do the first option in the example below.</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment"># </span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment"># 1. Using `workspace.RunNetOnce()`, which instantiates, runs and immediately destructs the network. </span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment"># 2. A little bit more complex and involves two steps: </span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">#     (a) call `workspace.CreateNet()` to create the C++ net object owned by the workspace, and</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">#     (b) use `workspace.RunNet()` by passing the name of the network to it.</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">#     </span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment"># </span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment"># In[23]:</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;workspace.ResetWorkspace()</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;print(<span class="stringliteral">&quot;Current blobs in the workspace: {}&quot;</span>.format(workspace.Blobs()))</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;workspace.RunNetOnce(net)</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;print(<span class="stringliteral">&quot;Blobs in the workspace after execution: {}&quot;</span>.format(workspace.Blobs()))</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment"># Let&#39;s dump the contents of the blobs</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="keywordflow">for</span> name <span class="keywordflow">in</span> workspace.Blobs():</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    print(<span class="stringliteral">&quot;{}:\n{}&quot;</span>.format(name, workspace.FetchBlob(name)))</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment"># Now let&#39;s try the second way to create the net, and run it. First clear the variables with `ResetWorkspace()`, create the net with the workspace&#39;s net object you created earlier `CreateNet(net_object)`, and then run the net by name with `RunNet(net_name)`.</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment"># In[24]:</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;workspace.ResetWorkspace()</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;print(<span class="stringliteral">&quot;Current blobs in the workspace: {}&quot;</span>.format(workspace.Blobs()))</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;workspace.CreateNet(net)</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;workspace.RunNet(net.Proto().name)</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;print(<span class="stringliteral">&quot;Blobs in the workspace after execution: {}&quot;</span>.format(workspace.Blobs()))</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="keywordflow">for</span> name <span class="keywordflow">in</span> workspace.Blobs():</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    print(<span class="stringliteral">&quot;{}:\n{}&quot;</span>.format(name, workspace.FetchBlob(name)))</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment"># There are a few differences between `RunNetOnce` and `RunNet`, but probably the main difference is the computation time overhead. Since `RunNetOnce` involves serializing the protobuf to pass between Python and C and instantiating the network, it may take longer to run. Let&#39;s see in this case what the overhead is.</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment"># In[25]:</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment"># It seems that %timeit magic does not work well with</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment"># C++ extensions so we&#39;ll basically do for loops</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;start = time.time()</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1000):</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    workspace.RunNetOnce(net)</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;end = time.time()</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;print(<span class="stringliteral">&#39;Run time per RunNetOnce: {}&#39;</span>.format((end - start) / 1000))</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;start = time.time()</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1000):</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    workspace.RunNet(net.Proto().name)</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;end = time.time()</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;print(<span class="stringliteral">&#39;Run time per RunNet: {}&#39;</span>.format((end - start) / 1000))</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment"># OK, so above are a few key components if you would like to use Caffe2 from the python side. We are going to add more to the tutorial as we find more needs. For now, kindly check out the rest of the tutorials!</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div><div class="ttc" id="namespacecaffe2_1_1python_html"><div class="ttname"><a href="namespacecaffe2_1_1python.html">caffe2.python</a></div><div class="ttdef"><b>Definition:</b> <a href="python_2____init_____8py_source.html#l00001">__init__.py:1</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.14-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Mar 3 2018 13:03:31 for Caffe2 - Python API by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
<div class="footerContainer">
  <div id="footer_wrap" class="wrapper footerWrapper">
    <div class="footerBlocks">
      <div id="fb_oss" class="footerSection fbOpenSourceFooter">
          <svg class="facebookOSSLogoSvg" viewBox="0 0 1133.9 1133.9" x="0px" y="0px" height=50 width=50>
            <g>
              <path class="logoRing outerRing" d="M 498.3 3.7 c 153.6 88.9 307.3 177.7 461.1 266.2 c 7.6 4.4 10.3 9.1 10.3 17.8 c -0.3 179.1 -0.2 358.3 0 537.4 c 0 8.1 -2.4 12.8 -9.7 17.1 c -154.5 88.9 -308.8 178.1 -462.9 267.5 c -9 5.2 -15.5 5.3 -24.6 0.1 c -153.9 -89.2 -307.9 -178 -462.1 -266.8 C 3 838.8 0 833.9 0 825.1 c 0.3 -179.1 0.2 -358.3 0 -537.4 c 0 -8.6 2.6 -13.6 10.2 -18 C 164.4 180.9 318.4 92 472.4 3 C 477 -1.5 494.3 -0.7 498.3 3.7 Z M 48.8 555.3 c 0 79.9 0.2 159.9 -0.2 239.8 c -0.1 10 3 15.6 11.7 20.6 c 137.2 78.8 274.2 157.8 411 237.3 c 9.9 5.7 17 5.7 26.8 0.1 c 137.5 -79.8 275.2 -159.2 412.9 -238.5 c 7.4 -4.3 10.5 -8.9 10.5 -17.8 c -0.3 -160.2 -0.3 -320.5 0 -480.7 c 0 -8.8 -2.8 -13.6 -10.3 -18 C 772.1 218 633.1 137.8 494.2 57.4 c -6.5 -3.8 -11.5 -4.5 -18.5 -0.5 C 336.8 137.4 197.9 217.7 58.8 297.7 c -7.7 4.4 -10.2 9.2 -10.2 17.9 C 48.9 395.5 48.8 475.4 48.8 555.3 Z" />
              <path class="logoRing middleRing" d="M 184.4 555.9 c 0 -33.3 -1 -66.7 0.3 -100 c 1.9 -48 24.1 -86 64.7 -110.9 c 54.8 -33.6 110.7 -65.5 167 -96.6 c 45.7 -25.2 92.9 -24.7 138.6 1 c 54.4 30.6 108.7 61.5 162.2 93.7 c 44 26.5 67.3 66.8 68 118.4 c 0.9 63.2 0.9 126.5 0 189.7 c -0.7 50.6 -23.4 90.7 -66.6 116.9 c -55 33.4 -110.8 65.4 -167.1 96.5 c -43.4 24 -89 24.2 -132.3 0.5 c -57.5 -31.3 -114.2 -64 -170 -98.3 c -41 -25.1 -62.9 -63.7 -64.5 -112.2 C 183.5 621.9 184.3 588.9 184.4 555.9 Z M 232.9 556.3 c 0 29.5 0.5 59.1 -0.1 88.6 c -0.8 39.2 16.9 67.1 50.2 86.2 c 51.2 29.4 102.2 59.2 153.4 88.4 c 31.4 17.9 63.6 18.3 95 0.6 c 53.7 -30.3 107.1 -61.2 160.3 -92.5 c 29.7 -17.5 45 -44.5 45.3 -78.8 c 0.6 -61.7 0.5 -123.5 0 -185.2 c -0.3 -34.4 -15.3 -61.5 -44.9 -79 C 637.7 352.6 583 320.8 527.9 290 c -27.5 -15.4 -57.2 -16.1 -84.7 -0.7 c -56.9 31.6 -113.4 64 -169.1 97.6 c -26.4 15.9 -40.7 41.3 -41.1 72.9 C 232.6 491.9 232.9 524.1 232.9 556.3 Z" />
              <path class="logoRing innerRing" d="M 484.9 424.4 c 69.8 -2.8 133.2 57.8 132.6 132 C 617 630 558.5 688.7 484.9 689.1 c -75.1 0.4 -132.6 -63.6 -132.7 -132.7 C 352.1 485 413.4 421.5 484.9 424.4 Z M 401.3 556.7 c -3.4 37.2 30.5 83.6 83 84.1 c 46.6 0.4 84.8 -37.6 84.9 -84 c 0.1 -46.6 -37.2 -84.4 -84.2 -84.6 C 432.2 472.1 397.9 518.3 401.3 556.7 Z" />
            </g>
          </svg>
        <h2>Facebook Open Source</h2>
      </div>
      <div class="footerSection">
        <a class="footerLink" href="https://code.facebook.com/projects/" target="_blank">Open Source Projects</a>
        <a class="footerLink" href="https://github.com/facebook/" target="_blank">GitHub</a>
        <a class="footerLink" href="https://twitter.com/fbOpenSource" target="_blank">Twitter</a>
      </div>
      <div class="footerSection rightAlign">
        <a class="footerLink" href="https://github.com/caffe2/caffe2" target="_blank">Contribute to this project on GitHub</a>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript" src="/js/jekyll-link-anchors.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', '{{ site.gacode }}', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
